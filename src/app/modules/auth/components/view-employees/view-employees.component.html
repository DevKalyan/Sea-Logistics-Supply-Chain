<div class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1 class="m-0">View Employees</h1>
            </div><!-- /.col -->
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item">Admin</li>
                    <li class="breadcrumb-item active">View Employees</li>
                </ol>
            </div><!-- /.col -->
        </div><!-- /.row -->
    </div><!-- /.container-fluid -->
</div>
<!-- /.content-header -->
<!-- Main content -->
<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <div class="card card-primary">
                    <div class="card-header">
                        <h3 class="card-title">All Employees List</h3>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-12">
                        <input type="text" placeholder="Search" class="form-control mb-2" [(ngModel)]="searchText"
                            (keyup)="search()" />
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <ng-container *ngIf="showUserIdColumn">
                                        <th scope="col" (click)="sort('UserId')">Userid</th>
                                    </ng-container>
                                    <th scope="col" (click)="sort('user_FirstName')">First Name</th>
                                    <th scope="col" (click)="sort('user_LastName')">Last Name</th>
                                    <th scope="col" (click)="sort('user_Email')">Email</th>
                                    <th scope="col" (click)="sort('user_PhoneNumber')">Phone Number</th>
                                    <th scope="col" (click)="sort('Username')">Username</th>
                                    <th scope="col" (click)="sort('Active')">IsActive</th>
                                    <th scope="col" (click)="sort('Password Changed')">Password Changed</th>
                                    <th scope="col">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr
                                    *ngFor="let employee of filteredEmployeesList | paginate: { itemsPerPage: pageSize, currentPage: currentPage }">
                                    <ng-container *ngIf="showUserIdColumn">
                                        <td>{{ employee?.UserId }}</td>
                                    </ng-container>
                                    <td>{{ employee?.UserBasicDetails?.User_FirstName }}</td>
                                    <td>{{ employee?.UserBasicDetails?.User_LastName }}</td>
                                    <td>{{ employee?.UserBasicDetails?.User_Email }}</td>
                                    <td>{{ employee?.UserBasicDetails?.User_PhoneNumber }}</td>
                                    <td>{{ employee?.UserCredentials?.Username }}</td>
                                    <td>
                                        <label class="switch">
                                            <input type="checkbox"
                                                [checked]="employee?.UserBasicDetails?.User_Active === 'Active'"
                                                disabled>
                                            <span class="slider round"></span>
                                        </label>
                                        <span class="text">{{ employee?.UserBasicDetails?.User_Active === 'Active' ?
                                            'Yes' : 'No' }}</span>
                                    </td>
                                    <td>
                                        <label class="switch">
                                            <input type="checkbox"
                                                [checked]="employee?.UserCredentials?.PasswordChanged === 1" disabled>
                                            <span class="slider round"></span>
                                            <span class="text">{{ employee?.UserCredentials?.PasswordChanged === 1 ?
                                                'Yes' : 'No' }}</span>
                                        </label>
                                    </td>
                                    <td>
                                        <button class="btn btn-primary" (click)="editEmployee(employee)">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <span style="margin-left: 5px;"></span> <!-- Add space here -->
                                        <button class="btn btn-danger" (click)="deleteEmployee(employee)">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <!-- <pagination-controls (pageChange)="onPageChange($event)" previousLabel="Previous" nextLabel="Next" max-size="5"
                          directionLinks="true" [responsive]="true" [currentPage]="currentPage" [itemsPerPage]="pageSize">
                        </pagination-controls> -->
                    </div>
                </div>
            </div>
        </div>
    </div>

</section>

<!-- Edit Modal-->
<div class="modal" #editModal>
    <div class="modal-dialog modal-dialog-centered modal-square" role="document">
        <div class="modal-content">
            <div class="modal-header bg-primary">
                <h5 class="modal-title">Edit Item</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="closeModal()">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body">
                <form [formGroup]="employeeform">
                    <div class="row">
                        <!-- <div class="col-md-1">
                            <div class="card card-warning">
                                <div class="card-header">
                                    <h3 class="card-title">Actions</h3>
                                </div>
                                <div class="card-body">
                                    <div class="btn-group mb-2">
                                        <button type="submit" class="btn btn-success" >Submit <i
                                                class="fas fa-save ml-1"></i></button>
                                    </div>
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-danger">Clear <i
                                                class="fas fa-times ml-1"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div> -->
                        <div class="col-12">
                            <div class="card card-primary card-tabs">
                                <div class="card-header p-0 pt-1">
                                    <ul class="nav nav-tabs" id="custom-tabs-one-tab" role="tablist">
                                        <li class="nav-item">
                                            <a class="nav-link active" id="custom-tabs-one-userbasic-tab"
                                                data-toggle="pill" href="#custom-tabs-user-basic" role="tab"
                                                aria-controls="custom-tabs-user-basic" aria-selected="true">Existing
                                                User
                                                Details</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="custom-tabs-one-credentials-tab" data-toggle="pill"
                                                href="#custom-tabs-user-cred" role="tab"
                                                aria-controls="custom-tabs-user-cred" aria-selected="false">Alocated
                                                Menus</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="card-body">
                                    <div class="tab-content" id="custom-tabs-one-tabContent">
                                        <div class="tab-pane fade show active" id="custom-tabs-user-basic"
                                            formGroupName="UserBasicDetails" role="tabpanel"
                                            aria-labelledby="custom-tabs-one-userbasic-tab">
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label for="lblEmpFirstname">First Name :</label>
                                                        <input type="text" class="form-control" id="txtempFirstname"
                                                            formControlName="firstName" name="firstName"
                                                            placeholder="Enter First name"
                                                            [ngClass]="{'is-invalid': submitted && employeeform.get('UserBasicDetails.firstName')?.errors}">

                                                            <input type="hidden" class="form-control" id="txtempUserid" formControlName="Userid" name="Userid">
                                                        <div class="invalid-feedback"
                                                            *ngIf="submitted && employeeform.get('UserBasicDetails.firstName')?.errors">
                                                            <span
                                                                *ngIf="employeeform.get('UserBasicDetails.firstName')?.errors?.['required']">
                                                                First Name is required
                                                            </span>
                                                            <span
                                                                *ngIf="employeeform.get('UserBasicDetails.firstName')?.errors?.['maxlength']">
                                                                First Name exceeds 5 characters
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label for="lblEmpMiddlename">Middle Name :</label>
                                                        <input type="text" class="form-control" id="txtempMiddlename"
                                                            formControlName="middleName" placeholder="Middle Name">
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label for="lblEmpLastname">Last Name :</label>
                                                        <input type="text" class="form-control" id="txtempLastname"
                                                            formControlName="lastName" name="lastName"
                                                            placeholder="Enter Last name"
                                                            [ngClass]="{'is-invalid': submitted && employeeform.get('UserBasicDetails.lastName')?.errors}">
                                                        <div class="invalid-feedback"
                                                            *ngIf="submitted && employeeform.get('UserBasicDetails.lastName')?.errors">
                                                            <span
                                                                *ngIf="employeeform.get('UserBasicDetails.lastName')?.errors?.['required']">
                                                                Last Name is required
                                                            </span>
                                                            <span
                                                                *ngIf="employeeform.get('UserBasicDetails.lastName')?.errors?.['maxlength']">
                                                                LAst Name exceeds 50 characters
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label for="empEmail">Email :</label>
                                                        <input type="text" class="form-control" id="empEmail"
                                                            formControlName="emailId" placeholder="Enter email"
                                                            [ngClass]="{'is-invalid': submitted && employeeform.get('UserBasicDetails.emailId')?.errors}">
                                                        <div class="invalid-feedback"
                                                            *ngIf="submitted && employeeform.get('UserBasicDetails.emailId')?.errors">
                                                            <span
                                                                *ngIf="employeeform.get('UserBasicDetails.emailId')?.errors?.['required']">
                                                                email is required
                                                            </span>
                                                            <span
                                                                *ngIf="employeeform.get('UserBasicDetails.emailId')?.errors?.['email']">
                                                                Please enter a valid email address
                                                            </span>
                                                        </div>
                                                    </div>

                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label for="empDesignation">Designation :</label>
                                                        <select class="form-control select2 select2-primary"
                                                            data-dropdown-css-class="select2-danger"
                                                            style="width: 100%;" formControlName="designation"
                                                            [ngClass]="{'is-invalid': submitted && employeeform.get('UserBasicDetails.designation')?.errors}"
                                                            style="width: 100%;" select2="true">
                                                            <option value="" selected>Choose Designation</option>
                                                            <option *ngFor="let item of designationDetails"
                                                                [value]="item.PrimaryId">{{ item.DesignationName }}
                                                            </option>
                                                        </select>
                                                        <div class="invalid-feedback"
                                                            *ngIf="submitted && employeeform.get('UserBasicDetails.designation')?.errors">
                                                            <span
                                                                *ngIf="employeeform.get('UserBasicDetails.designation')?.errors?.['required']">
                                                                Choose Designation
                                                            </span>
                                                        </div>
                                                    </div>

                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label for="empCountry">User Type:</label>
                                                        <select class="form-control" formControlName="userType"
                                                            [ngClass]="{'is-invalid': submitted && employeeform.get('UserBasicDetails.userType')?.errors}">
                                                            <option value="">Choose UserType</option>
                                                            <option *ngFor="let userType of usertypeDetails"
                                                                [value]="userType.PrimaryId">{{ userType.UserTypeName }}
                                                            </option>
                                                        </select>
                                                        <div class="invalid-feedback"
                                                            *ngIf="submitted && employeeform.get('UserBasicDetails.userType')?.errors">
                                                            <span
                                                                *ngIf="employeeform.get('UserBasicDetails.userType')?.errors?.['required']">
                                                                Choose country
                                                            </span>
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label for="empCountry">Country:</label>
                                                        <select class="form-control" formControlName="country"
                                                            [ngClass]="{'is-invalid': submitted && employeeform.get('UserBasicDetails.country')?.errors}">
                                                            <option value="">Choose Country</option>
                                                            <option *ngFor="let country of countries"
                                                                [value]="country.alpha3Code">{{ country.name }}</option>
                                                        </select>
                                                        <div class="invalid-feedback"
                                                            *ngIf="submitted && employeeform.get('UserBasicDetails.country')?.errors">
                                                            <span
                                                                *ngIf="employeeform.get('UserBasicDetails.country')?.errors?.['required']">
                                                                Choose country
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>


                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label for="empState">State:</label>
                                                        <!-- <select class="form-control" formControlName="state"
                                                            [ngClass]="{'is-invalid': submitted && employeeform.get('UserBasicDetails.state')?.errors}">
                                                            <option value="">Choose State</option>
                                                            <option value="KA">Karnataka</option>
                                                            <!-- <option *ngFor="let state of states" [value]="state.code">{{
                                                                state.name }}</option>
                                                        </select> -->
                                                        <input type="text" class="form-control" id="empStage"
                                                            formControlName="state" placeholder="Enter State"
                                                            [ngClass]="{'is-invalid': submitted && employeeform.get('UserBasicDetails.state')?.errors}">
                                                        <div class="invalid-feedback"
                                                            *ngIf="submitted && employeeform.get('UserBasicDetails.state')?.errors">
                                                            <span
                                                                *ngIf="employeeform.get('UserBasicDetails.state')?.errors?.['state']">
                                                                State is required
                                                            </span>
                                                        </div>
                                                    </div>

                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label for="empPostalCode">Postal Code :</label>
                                                        <input type="text" class="form-control" id="empPostalCode"
                                                            formControlName="postalCode"
                                                            [ngClass]="{'is-invalid': submitted && employeeform.get('UserBasicDetails.state')?.errors}"
                                                            placeholder="Postal Code">
                                                        <div class="invalid-feedback"
                                                            *ngIf="submitted && employeeform.get('UserBasicDetails.postalCode')?.errors">
                                                            <span
                                                                *ngIf="employeeform.get('UserBasicDetails.postalCode')?.errors?.['required']">
                                                                Enter Postal Code
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label for="empPhoneNo">Phone Number :</label>
                                                        <input type="text" class="form-control" id="empPhoneNo"
                                                            formControlName="phoneNo" placeholder="Phone Number"
                                                            [ngClass]="{'is-invalid': submitted && employeeform.get('UserBasicDetails.phoneNo')?.errors}">
                                                        <div class="invalid-feedback"
                                                            *ngIf="submitted && employeeform.get('UserBasicDetails.phoneNo')?.errors">
                                                            <span
                                                                *ngIf="employeeform.get('UserBasicDetails.phoneNo')?.errors?.['required']">
                                                                Enter Phone Number
                                                            </span>
                                                        </div>
                                                    </div>

                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <div class="form-group">
                                                            <label for="lblEmpDateofBirth">Date of Birth :</label>
                                                            <input matInput [matDatepicker]="picker"
                                                                formControlName="dateOfBirth" id="txtEmpDateofBirth"
                                                                placeholder="Date Of Birth"
                                                                [ngClass]="{'is-invalid': submitted && employeeform.get('UserBasicDetails.dateOfBirth')?.errors}">
                                                            <mat-datepicker-toggle matSuffix
                                                                [for]="picker"></mat-datepicker-toggle>
                                                            <mat-datepicker #picker></mat-datepicker>
                                                            <div class="invalid-feedback"
                                                                *ngIf="submitted && employeeform.get('UserBasicDetails.dateOfBirth')?.errors">
                                                                <span
                                                                    *ngIf="employeeform.get('UserBasicDetails.dateOfBirth')?.errors?.['required']">
                                                                    Enter Date of Birth
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label>User Active</label>
                                                        <div class="switch-container">
                                                            <label class="switch">
                                                                <input type="checkbox" formControlName="isActive">
                                                                <span class="slider round">
                                                                    <span class="yes-no-label">{{
                                                                        employeeform.get('UserBasicDetails.isActive')?.value
                                                                        ? 'Yes' : 'No' }}</span>
                                                                </span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <div class="form-group">
                                                            <label for="lblEmpDateofBirth">User Time Zone :</label>
                                                            <select class="form-control" formControlName="timeZone"
                                                                [ngClass]="{'is-invalid': submitted && employeeform.get('UserBasicDetails.timeZone')?.errors}">
                                                                <option value="">Choose TimeZone</option>
                                                                <!-- <option *ngFor="let country of countries"
                                                                [value]="country.alpha3Code">{{ country.name }}</option> -->
                                                                <option value="-08:00">(GMT -8:00) Pacific Time (US
                                                                    &amp; Canada)</option>
                                                                <option value="-07:00">(GMT -7:00) Mountain Time (US
                                                                    &amp; Canada)</option>
                                                                <option value="-06:00">(GMT -6:00) Central Time (US
                                                                    &amp; Canada), Mexico City</option>
                                                                <option value="-05:00">(GMT -5:00) Eastern Time (US
                                                                    &amp; Canada), Bogota, Lima</option>
                                                                <option value="+05:50">(GMT +5:30) Bombay, Calcutta,
                                                                    Madras, New Delhi</option>
                                                            </select>
                                                            <div class="invalid-feedback"
                                                                *ngIf="submitted && employeeform.get('UserBasicDetails.timeZone')?.errors">
                                                                <span
                                                                    *ngIf="employeeform.get('UserBasicDetails.timeZone')?.errors?.['required']">
                                                                    Enter Date of Birth
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label>Has DayLight Savings</label>
                                                        <div class="switch-container">
                                                            <label class="switch">
                                                                <input type="checkbox" formControlName="dayLightSaving">
                                                                <span class="slider round">
                                                                    <span class="yes-no-label">{{
                                                                        employeeform.get('UserBasicDetails.dayLightSaving')?.value
                                                                        ? 'Yes' : 'No' }}</span>
                                                                </span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <!-- <div class="col-md-3">
                                                    <div class="form-group">
                                                        <label for="lblEmpUsername">User Name :</label>
                                                        <input type="text" class="form-control" id="txtempUsername"
                                                            formControlName="username"
                                                            [ngClass]="{'is-invalid': submitted && employeeform.get('UserBasicDetails.username')?.errors}"
                                                            placeholder="Enter UserName">
                                                        <div class="invalid-feedback"
                                                            *ngIf="submitted && employeeform.get('UserBasicDetails.username')?.errors">
                                                            <span
                                                                *ngIf="employeeform.get('UserBasicDetails.username')?.errors?.['required']">
                                                                Enter Username
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div> -->
                                                <!-- <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label for="lblEmpPassword">Password :</label>
                                                        <input type="password" class="form-control" id="txtemppassword"
                                                            formControlName="password"
                                                            [ngClass]="{'is-invalid': submitted && employeeform.get('UserBasicDetails.password')?.errors}"
                                                            placeholder="Password">
                                                        <div class="invalid-feedback"
                                                            *ngIf="submitted && employeeform.get('UserBasicDetails.password')?.errors">
                                                            <span
                                                                *ngIf="employeeform.get('UserBasicDetails.password')?.errors?.['required']">
                                                                Enter password
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div> -->
                                                <!-- <div class="col-md-2">
                                                    <div class="form-group">
                                                        <label>Password Changed</label>
                                                        <div class="switch-container">
                                                            <label class="switch">
                                                                <input type="checkbox"
                                                                    formControlName="passwordChanged">
                                                                <span class="slider round">
                                                                    <span class="yes-no-label">{{
                                                                        employeeform.get('UserBasicDetails.passwordChanged')?.value
                                                                        ? 'Yes' : 'No' }}</span>
                                                                </span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div> -->
                                                <!-- <div class="col-md-3">
                                                    <div class="form-group">
                                                        <label for="lblEmpPasswordChangeDt">Password Changed Date
                                                            :</label>
                                                        <input type="text" class="form-control"
                                                            formControlName="passwordChangeDate"
                                                            id="txtEmpPasswordChhangeDt" readonly>
                                                    </div>
                                                </div> -->
                                            </div>

                                        </div>
                                        <div class="tab-pane fade" id="custom-tabs-user-cred" role="tabpanel"
                                            aria-labelledby="custom-tabs-one-credentials-tab">
                                            <!-- menu Items-->
                                            <div *ngFor="let menu of menuData">
                                                <h4>{{ menu.MenuHeaderName }}</h4>
                                                <div class="row">
                                                    <div class="col">
                                                        <div class="card p-0">
                                                            <!-- Added "p-0" to remove padding -->
                                                            <div class="card-body">
                                                                <div class="row">
                                                                    <div class="col-md-auto"
                                                                        *ngFor="let item of menu.MenuDetails">
                                                                        <!-- Added "col-md-auto" to adjust column width based on content -->
                                                                        <div
                                                                            class="custom-control custom-checkbox mb-2">
                                                                            <!-- Added "mb-2" to reduce margin bottom -->
                                                                            <input
                                                                                class="custom-control-input custom-control-input-success"
                                                                                type="checkbox"
                                                                                id="{{ item.MenuDetailsCode }}"
                                                                                value="{{ item.MenuDetailsCode }}"
                                                                                [checked]="isSelected(item.MenuDetailsCode)"
                                                                                (change)="getSelectedMenus($event)">
                                                                            <label class="custom-control-label"
                                                                                for="{{ item.MenuDetailsCode }}">{{
                                                                                item.MenuDetailsName }}</label>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <!-- /.card -->
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" *ngIf="action === 'delete'"
                    (click)="confirmDelete()">Delete</button>
                <button type="button" class="btn btn-primary" *ngIf="action === 'edit'"
                    (click)="UpdateEmployee()">Update</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal"
                    (click)="closeModal()">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Employee Modal -->
<div class="modal" tabindex="-1" role="dialog" #deleteModal>
    <!-- Modal content goes here -->
    <div class="modal-dialog modal-dialog-centered modal-square" role="document">
      <div class="modal-content">
        <div class="modal-header bg-danger">
            <h5 class="modal-title">Confirm Delete</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="closeDeleteModal()">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          Are you sure you want to delete this employee?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal" (click)="closeDeleteModal()">Cancel</button>
          <button type="button" class="btn btn-danger" (click)="confirmDelete()">Delete</button>
        </div>
      </div>
    </div>
  </div>